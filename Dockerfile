# Базовый образ: официальный Python 3.10 в "лёгкой" версии (без ненужных пакетов)
#    - slim = меньше размер, быстрее загружается, безопаснее
#    - Не содержит компиляторы, лишние библиотеки — только необходимое
FROM python:3.10-slim

# Устанавливаем рабочую директорию внутри контейнера
#    Все последующие команды (COPY, RUN, CMD) будут выполняться в /app
WORKDIR /app

# Копируем ТОЛЬКО requirements.txt сначала
#    Это позволяет Docker кэшировать установку пакетов
#    Если requirements.txt не менялся — pip install не запускается заново при каждом билде
COPY requirements.txt .

# Устанавливаем зависимости из requirements.txt
#    --no-cache-dir — экономим место в образе (не храним кэш pip)
#    -r requirements.txt — читаем список пакетов
RUN pip install --no-cache-dir -r requirements.txt

# Копируем ВЕСЬ проект (включая main.py, configs/, src/ и т.д.) в рабочую директорию
#    Важно: .env тоже попадёт внутрь, если он есть (но он должен быть в .gitignore!)
COPY . .

# Команда по умолчанию при запуске контейнера
#    - uvicorn — ASGI-сервер для FastAPI
#    - main:app — означает: импортируй переменную `app` из файла `main.py`
#    - --host 0.0.0.0 — слушаем все сетевые интерфейсы (внутри контейнера)
#    - --port 8000 — порт, который будет открыт (должен совпадать с тем, что в docker-compose)
#    Этот порт — внутренний! Внешний задаётся в docker-compose.yml
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]