from pydantic import BaseModel
from typing import Optional, List, Literal


# СХЕМЫ ДЛЯ ОЦЕНКИ ОТВЕТА УЧЕНИКА
# Используются в API-эндпоинте /evaluate
class EvaluateRequest(BaseModel):
    """
    Схема входных данных для эндпоинта оценки ответа студента.

    Определяет структуру и типы данных, которые ожидает API при получении POST-запроса.
    FastAPI автоматически валидирует входящие данные: проверяет наличие обязательных полей,
    их типы и соответствие формату. При несоответствии возвращается ошибка 422 (Unprocessable Entity).

    Args:
        BaseModel (pydantic.BaseModel): Базовый класс Pydantic для создания моделей данных с валидацией.
    """
    # FastAPI автоматически проверяет, что:
    #      - пришли поля `answer` и `subject`
    #      - они имеют правильный тип (str)
    #      - поле `criteria` — опционально, если есть, то это список строк

    # Обязательное поле: текст ответа ученика
    answer: str

    # Обязательное поле: предмет (например, "Математика", "История")
    subject: str

    # Опциональное поле: список критериев оценки
    # Пример: ["ясность", "логика", "грамматика"]
    # Optional[List[str]] означает: может быть списком строк ИЛИ None
    criteria: Optional[List[str]] = None


class EvaluateResponse(BaseModel):
    """
    Схема выходных данных для ответа API после оценки ответа студента.

    Определяет структуру JSON-ответа, возвращаемого эндпоинтом оценки.
    FastAPI использует эту модель для автоматической валидации выходных данных
    и генерации документации (например, на странице /docs).

    Args:
        BaseModel (pydantic.BaseModel): Базовый класс Pydantic для создания моделей данных с валидацией.
    """
    # FastAPI использует эту схему, чтобы:
    #      - указать структуру ответа в документации (/docs)
    #      - автоматически валидировать, что возвращаемые данные соответствуют формату

    # Оценка по шкале (например, от 1 до 5)
    score: int

    # Текстовый фидбэк от системы или ИИ
    feedback: str


# СХЕМЫ ДЛЯ СОКРАЩЕНИЯ ТЕКСТА (SUMMARIZATION)
# Можно использовать в эндпоинте, например /summarize
class SummarizeRequest(BaseModel):
    """
    Схема входных данных для запроса на сокращение текста.

    Определяет формат данных, которые ожидает эндпоинт сокращения.
    Содержит одно обязательное поле — текст, подлежащий обработке.

    Args:
        BaseModel (pydantic.BaseModel): Базовый класс Pydantic для создания моделей данных с валидацией.
    """
    # Ожидается один обязательный параметр — текст, который нужно кратко пересказать.

    # Обязательное поле: текст для сокращения
    text: str


class SummarizeResponse(BaseModel):
    """
    Схема выходных данных для ответа API после сокращения текста.

    Определяет структуру результата, возвращаемого после успешного сокращения.
    Гарантирует, что ответ будет содержать только допустимые поля.

    Args:
        BaseModel (pydantic.BaseModel): Базовый класс Pydantic для создания моделей данных с валидацией.
    """
    # Результат — краткое изложение
    summary: str


class EvaluationResult(BaseModel):
    """
    Схема ожидаемого структурированного JSON-ответа от языковой модели.

    Используется для guided decoding (управляемого декодирования) при генерации ответов,
    чтобы гарантировать, что вывод модели соответствует заданной структуре.
    Поддерживается через бэкенды xgrammar или guidance в vLLM.
    Документация: https://docs.vllm.ai/en/v0.8.5.post1/features/structured_outputs.html

    Args:
        BaseModel (pydantic.BaseModel): Базовый класс Pydantic для создания моделей данных с валидацией.
    """
    score: int = 4  # Оценка по шкале, например, от 1 до 5
    feedback: str   # Текстовый фидбэк учителя
    difficulty: Literal["easy", "medium", "hard"]  # Жёстко заданные значения


# ===========================================================================
# ЗАЧЕМ ЭТО НУЖНО?
# ===========================================================================
#
# 1. Валидация данных
#    - Если клиент прислал `score: "пять"` вместо числа — ошибка 422
#    - Если забыл `subject` — ошибка 422
#
# 2. Авто-документация
#    - FastAPI автоматически создаёт красивый интерфейс /docs (Swagger)
#    - Там будут показаны эти схемы — удобно тестировать
#
# 3. Подсказки в коде (IDE)
#    - PyCharm / VSCode будет подсказывать поля: request.answer, request.subject
#
# 4. Безопасность и предсказуемость
#    - Мы точно знаем, что получили корректные данные
#    - Не нужно писать ручные проверки вроде `if 'answer' not in data: ...`
#
# 5. Поддержка JSON
#    - FastAPI автоматически конвертирует JSON → Python объекты и обратно